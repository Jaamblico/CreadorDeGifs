//Variables

let video;
let amplitude;
let tronSong;
let multiplicador = 0.9;
let canvas1;
let canvas2;
let buttonSnap;
let buttonPlay;
let buttonStop;
let buttonSave;
let buttonSaveGif;
let colorPicker;
let pixelSlider;
let alphaSlider;
let P;
let pincelSwitch = false;
let ampHistory = [];
let leyenda;
let imagenNueva;
let imagenSwitch = false;

function preload() {
  soundFormats('mp3');
  tronSong = loadSound('Assets/endOfLine');
  imagenNueva = createImg("data:image/jpeg;base64,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");
  imagenNueva.position(2000,0);
}

function setup() {
  rectMode(CENTER);
  canvas1 = createCanvas(1280, 480);
  canvas2 = createGraphics(640, 480);
  canvas1.background(30);
  canvas2.background(100);
  canvas2.noFill();
  canvas2.strokeWeight(10);
  canvas2.stroke(255);
  canvas2.rect(6,6,628,height-10);
  buttonSnap = createButton("Snap!");
  buttonSnap.mousePressed(takeSnap);
  colorPicker = createColorPicker('deeppink')
  buttonPlay = createButton("¡Reproducir!");
  buttonPlay.mousePressed(playSong);
  buttonPause = createButton("Pausar");
  buttonPause.mousePressed(pauseSong);
  buttonSave = createButton("Guardar Imagen");
  buttonSave.mousePressed(saveImg)
  buttonSaveGif = createButton("Guardar Gif");
  buttonSaveGif.mousePressed(gifSave);
  leyenda = select('#leyenda');
  p = createP("PixelSlider");
  p1 = createP("AlphaSlider");
  p.style("color","#FFFFFF");
  p1.style("color","#FFFFFF");
  p1.position(140,607.5);
  pixelSlider = createSlider(0.01, 1, 1,0.01);
  alphaSlider = createSlider(0.1,1,0.5,0.1);
  
  video = createCapture(VIDEO)
  amplitude = new p5.Amplitude();  
  video.hide();

  P = new Pincel(width/2,height/2);
}

function draw() {
  pixelDensity(pixelSlider.value())
  tint(colorPicker.value());
  image(canvas2, 640, 0);
  image(video, 0, 0, width/2, height); 
  if(tronSong.isPlaying()){
    ampHistory.push(amplitude.getLevel()*multiplicador);
    image(video, 0, 0, width*(ampHistory[ampHistory.length-1]), height);
    image(video, 0, 0, width*(ampHistory[ampHistory.length-2]), height);
    image(video, 0, 0, width*(ampHistory[ampHistory.length-3]), height);
    image(video, 0, 0, width*(ampHistory[ampHistory.length-4]), height);
    if(ampHistory.lenght > 5){
      ampHistory.splice(0,1);
    }
  }
  
    if(imagenSwitch){
      imagenNueva.position(mouseX,mouseY);
      imagenNueva.style('opacity',alphaSlider.value());
    }else{
      imagenNueva.position(2000,2000);
    }

  P.update();
  P.show();
  
  }

  function keyPressed() {
    if (keyCode === 65) {
      if(pincelSwitch == false){
        pincelSwitch = true;
      }else{
        pincelSwitch = false;
      }
    }
    if (keyCode === 73) {
      if(imagenSwitch == false){
        imagenSwitch = true;
      }else{
        imagenSwitch = false;
      }
    }
  }

function takeSnap(){
  canvas2.image(video,10,10,width*(ampHistory[ampHistory.length-1]),height-20);
  canvas2.noFill();
  canvas2.strokeWeight(10);
  canvas2.stroke(255);
  canvas2.rect(6,6,628,height-10);
}

function playSong(){
  tronSong.play()
}

function pauseSong(){
  tronSong.pause();
}

function saveImg(){
  saveCanvas('myCanvas.jpg');
}

function gifSave(){
  saveGif("myGif", 5);
}


function Pincel(x,y){
  this.x = x;
  this.y = y;
  this.history = [];
  this.diam = 60;

  this.update = function(){
    
    this.y = mouseY; 
    this.x = mouseX;

    this.v = createVector(this.x, this.y);
    this.history.push(this.v);
    if(this.history.length>300){
      this.history.splice(0,1);
    }
  }

  this.show = function(){
    noFill();
    stroke("orange")
    if(pincelSwitch){
    ellipse(this.x, this.y,this.diam ,this.diam);
      for(var i = 0; i < this.history.length;i++){
        stroke("rgb(250,8,8)")
        rect(this.history[i].x,this.history[i].y, random(20,50), random(20,50));
        rect(this.history[i].x,this.history[i].y, random(50,20), random(50,20));
      }
    }
  }
}
